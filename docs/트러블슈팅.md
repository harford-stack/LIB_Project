# 📚 PageStudy - 주요 이슈 개선 및 해결

## 🔧 트러블 슈팅

### 1. 소셜 로그인 세션 캐시 문제

#### 1. 문제상황

소셜 로그인(카카오, 네이버, 구글) 구현 후, 한 번 로그인한 사용자가 다시 로그인 버튼을 클릭했을 때 로그인 화면이 표시되지 않고 이전 세션이 자동으로 인증되는 문제가 발생했습니다. 이로 인해 다른 계정으로 로그인하려는 사용자가 불편을 겪었고, 테스트 시에도 계정 전환이 어려웠습니다.

#### 2. 원인

OAuth 2.0 인증 플로우에서 소셜 로그인 제공자(카카오, 네이버, 구글)가 브라우저 세션을 캐시하여, 이미 로그인한 사용자의 경우 자동으로 기존 세션을 재사용하는 동작이 기본값으로 설정되어 있었습니다. 이는 OAuth 2.0 스펙의 정상적인 동작이지만, 사용자가 명시적으로 로그인 화면을 보고 싶어하거나 다른 계정으로 로그인하고 싶을 때는 문제가 됩니다.

#### 3. 개선결과

- 사용자가 소셜 로그인 버튼을 클릭할 때마다 항상 로그인 화면이 표시됨
- 다른 계정으로 로그인하는 것이 가능해짐
- 테스트 환경에서 계정 전환이 용이해짐
- 사용자 경험 개선 및 명시적인 인증 플로우 보장

#### 4. 해결방안

OAuth 2.0 인증 요청 URL에 `prompt=login` 파라미터를 추가하여 세션 캐시를 무시하고 항상 로그인 화면을 표시하도록 수정했습니다.

```javascript
// 수정 전
const kakaoAuthUrl = `https://kauth.kakao.com/oauth/authorize?client_id=${clientId}&redirect_uri=${redirectUri}&response_type=code`;

// 수정 후
const kakaoAuthUrl = `https://kauth.kakao.com/oauth/authorize?client_id=${clientId}&redirect_uri=${redirectUri}&response_type=code&prompt=login`;
```

카카오, 네이버, 구글 모두 동일한 방식으로 `prompt=login` 파라미터를 추가하여 일관된 사용자 경험을 제공했습니다.

---

### 2. Git Push Protection으로 인한 보안 이슈

#### 1. 문제상황

프로젝트를 GitHub에 푸시하려고 할 때 "push declined due to repository rule violations" 오류가 발생했습니다. GitHub Push Protection이 `.env` 파일에 포함된 Google OAuth Client ID와 Secret을 민감한 정보로 감지하여 푸시를 차단했습니다.

#### 2. 원인

`.env` 파일이 Git에 추적되고 있었고, 이 파일에는 OAuth 클라이언트 ID와 Secret 같은 민감한 정보가 포함되어 있었습니다. GitHub는 보안을 위해 이러한 민감한 정보가 포함된 파일의 푸시를 자동으로 차단하는 Push Protection 기능을 제공하고 있었습니다.

#### 3. 개선결과

- 민감한 정보가 Git 저장소에 포함되지 않도록 보안 강화
- `.env` 파일이 `.gitignore`에 올바르게 등록되어 향후 실수 방지
- Git 히스토리에서 민감한 정보 제거로 보안 취약점 해결
- 환경 변수 관리 베스트 프랙티스 적용

#### 4. 해결방안

1. **`.gitignore` 확인 및 수정**: `server/.env` 파일이 `.gitignore`에 포함되어 있는지 확인하고, 없으면 추가했습니다.

2. **Git 추적에서 제거**: 이미 Git에 추적되고 있던 `.env` 파일을 추적에서 제거했습니다.
   ```bash
   git rm --cached server/.env
   ```

3. **커밋 수정**: 마지막 커밋을 수정하여 `.env` 파일이 제거된 상태로 반영했습니다.
   ```bash
   git commit --amend --no-edit
   ```

4. **`.env.example` 파일 생성**: 다른 개발자나 배포 환경을 위한 템플릿 파일을 생성하여 필요한 환경 변수 구조를 문서화했습니다.

이를 통해 민감한 정보는 로컬 `.env` 파일에만 유지하고, Git 저장소에는 포함하지 않도록 보안을 강화했습니다.

---
